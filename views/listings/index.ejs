<% layout("layouts/boilerplate") %>
<style>
    .filters-controls {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin: 1rem 0;
    }

    .filters-wrapper {
        position: relative;
        flex: 0 1 70%;
        max-width: 70%;
        min-width: 300px;
    }

    #filters {
        display: flex;
        gap: 1.5rem;
        overflow-x: auto;
        scroll-behavior: smooth;
        white-space: nowrap;
        padding: 1.2rem;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    #filters::-webkit-scrollbar {
        display: none;
    }

    .filter {
        text-align: center;
        opacity: 0.8;
        flex: 0 0 auto;
        min-width: 80px;
    }
    .filter:hover {
        opacity: 1;
        cursor: pointer;
    }
    .filter i {
        font-size: 1rem;
        margin-bottom: 0.3rem;
    }

    .scroll-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: white;
        border: 1px solid #ddd;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        z-index: 10;
        padding-left: 5px;
    }
    .scroll-btn:hover {
        background-color: rgb(39, 38, 38);
        color: white;
    }
    .scroll-btn i {
        font-size: 1.3rem;
    }
    .scroll-btn.left { left: -15px; }
    .scroll-btn.right { right: -15px; }

    /* Search & Sort section */
    .extras {
        flex: 0 0 30%;
        max-width: 30%;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 1rem;
    }

    /* Search Box Styling */
    .search-box {
        position: relative;
        width: 160px;
    }
    .search-box input {
        width: 100%;
        padding: 0.4rem 2rem 0.4rem 1rem;
        border-radius: 25px;
        border: 1px solid #ddd;
        outline: none;
    }
    .search-box i {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #666;
    }

    /* Custom Dropdown Styling */
    .custom-dropdown {
        position: relative;
        width: 160px;
    }
    .dropdown-btn {
        width: 100%;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        border: 1px solid #ddd;
        background: white;
        font-size: 0.9rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: 0.2s;
    }
    .dropdown-btn:hover {
        border-color: #333;
        box-shadow: 0 0 5px rgba(0,0,0,0.15);
    }
    .dropdown-list {
        display: none;
        position: absolute;
        top: 110%;
        left: 0;
        width: 100%;
        background: white;
        border: 1px solid #ddd;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        list-style: none;
        padding: 0;
        margin: 0;
        z-index: 100;
    }
    .dropdown-list li {
        padding: 0.6rem 1rem;
        cursor: pointer;
        font-size: 0.9rem;
    }
    .dropdown-list li:hover {
        background: #b5b5b5;
    }
    .dropdown-list.show {
        display: block;
    }
</style>

<body>
    <!-- Filters + Search + Sort in one row -->
    <div class="filters-controls">
        <div class="filters-wrapper">
            <button class="scroll-btn left" onclick="scrollFilters(-200)">
                <i class="fa-solid fa-angle-left"></i>
            </button>
            <div id="filters">
                <div class="filter"><i class="fa-solid fa-fire"></i><p>Trending</p></div>
                <div class="filter"><i class="fa-solid fa-bed"></i><p>Rooms</p></div>
                <div class="filter"><i class="fa-solid fa-mountain-city"></i><p>Iconic</p></div>
                <div class="filter"><i class="fa-solid fa-meteor"></i><p>OMG!</p></div>
                <div class="filter"><i class="fa-solid fa-warehouse"></i><p>Cabin</p></div>
                <div class="filter"><i class="fa-solid fa-umbrella-beach"></i><p>Beach</p></div>
                <div class="filter"><i class="fa-solid fa-campground"></i><p>Camping</p></div>
                <div class="filter"><i class="fa-solid fa-water"></i><p>Lakeside</p></div>
                <div class="filter"><i class="fa-solid fa-snowflake"></i><p>Arctic</p></div>
                <div class="filter"><i class="fa-solid fa-tree"></i><p>Nature</p></div>
                <div class="filter"><i class="fa-solid fa-hotel"></i><p>Hotels</p></div>
                <div class="filter"><i class="fa-solid fa-vihara"></i><p>Historic</p></div>
                <div class="filter"><i class="fa-solid fa-city"></i><p>Urban</p></div>
                <div class="filter"><i class="fa-solid fa-mountain-sun"></i><p>Mountains</p></div>
                <div class="filter"><i class="fa-solid fa-water-ladder"></i><p>Pools</p></div>
                <div class="filter"><i class="fa-solid fa-spa"></i><p>Luxury</p></div>
                <div class="filter"><i class="fa-solid fa-dog"></i><p>Pet-Friendly</p></div>
                <div class="filter"><i class="fa-solid fa-person-swimming"></i><p>Resorts</p></div>
                <div class="filter"><i class="fa-solid fa-ship"></i><p>Boats</p></div>
                <div class="filter"><i class="fa-solid fa-igloo"></i><p>Igloos</p></div>
                <div class="filter"><i class="fa-solid fa-archway"></i><p>Castles</p></div>
                <div class="filter"><i class="fa-solid fa-mug-hot"></i><p>Bed & Breakfast</p></div>
                <div class="filter"><i class="fa-solid fa-gopuram"></i><p>Religious</p></div>
                <div class="filter"><i class="fa-solid fa-house-chimney"></i><p>Family Homes</p></div>
                <div class="filter"><i class="fa-solid fa-chess-rook"></i><p>Unique Stays</p></div>
                <div class="filter"><i class="fa-solid fa-wine-glass"></i><p>Vineyards</p></div>
                <div class="filter"><i class="fa-solid fa-caravan"></i><p>Caravans</p></div>
                <div class="filter"><i class="fa-solid fa-tent"></i><p>Glamping</p></div>
                <div class="filter"><i class="fa-solid fa-van-shuttle"></i><p>Vanlife</p></div>
                <div class="filter"><i class="fa-solid fa-mountain"></i><p>Hiking</p></div>
            </div>
            <button class="scroll-btn right" onclick="scrollFilters(200)">
                <i class="fa-solid fa-angle-right"></i>
            </button>
        </div>

        <!-- Search + Custom Sort -->
        <div class="extras">
            <div class="search-box">
                <input id="searchInput" type="text" placeholder="Search...">
                <i class="fa-solid fa-magnifying-glass"></i>
            </div>
            <div class="custom-dropdown">
                <button id="dropdownBtn" class="dropdown-btn" onclick="toggleDropdown()">
                    Sort <i class="fa-solid fa-chevron-down"></i>
                </button>
                <ul id="dropdown-list" class="dropdown-list">
                    <li onclick="selectOption('low-high')">Price: Low → High</li>
                    <li onclick="selectOption('high-low')">Price: High → Low</li>
                    <li onclick="selectOption('title-a-z')">Title: A → Z</li>
                    <li onclick="selectOption('title-z-a')">Title: Z → A</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Listings -->
    <div id="listingContainer" class="row row-cols-lg-3 row-cols-md-3 row-cols-sm-1 mt-3">
        <% for(let listing of alllisting){ %>
        <a href="/listings/<%=listing._id%>" class="listing-link">
            <div class="listing-card col"
                 data-title="<%= listing.title %>"
                 data-location="<%= listing.location %>"
                 data-price="<%= listing.price || 0 %>">
                <img src="<%= listing.image.url %>" class="card-img-top" alt="listing_image" style="height: 20rem;">
                <div class="card-img-overlay"><%= listing.location %></div>
                <div class="card-body">
                    <h5 class="card-title"><%= listing.title %></h5>
                    <p class="card-text">
                        <%= (listing.price != null) ? listing.price.toLocaleString("en-IN") : "Price not available" %> /night
                    </p>
                </div>
            </div>
        </a>
        <% } %>
    </div>

    <script>
        // Scroll filters
        function scrollFilters(amount) {
            document.getElementById("filters").scrollBy({ left: amount, behavior: "smooth" });
        }

        // Dropdown toggle
        function toggleDropdown() {
            document.getElementById("dropdown-list").classList.toggle("show");
        }
        window.onclick = function(event) {
            if (!event.target.matches('.dropdown-btn') && !event.target.matches('.dropdown-btn *')) {
                document.getElementById("dropdown-list").classList.remove("show");
            }
        }

        // Sorting
        function selectOption(value) {
            const container = document.getElementById("listingContainer");
            let items = Array.from(container.querySelectorAll(".listing-link"));

            if (value === "low-high") items.sort((a,b)=> a.dataset.price - b.dataset.price);
            if (value === "high-low") items.sort((a,b)=> b.dataset.price - a.dataset.price);
            if (value === "title-a-z") items.sort((a,b)=> a.dataset.title.localeCompare(b.dataset.title));
            if (value === "title-z-a") items.sort((a,b)=> b.dataset.title.localeCompare(a.dataset.title));

            items.forEach(item => container.appendChild(item));
            document.getElementById("dropdown-list").classList.remove("show");

            const textMap = {
                "low-high": "Price: Low → High",
                "high-low": "Price: High → Low",
                "title-a-z": "Title: A → Z",
                "title-z-a": "Title: Z → A"
            };
            document.getElementById("dropdownBtn").innerHTML = textMap[value] + " <i class='fa-solid fa-chevron-down'></i>";
        }

        // Search
        document.getElementById("searchInput").addEventListener("input", function() {
            const term = this.value.toLowerCase();
            document.querySelectorAll(".listing-link").forEach(item => {
                const title = item.querySelector(".listing-card").dataset.title.toLowerCase();
                const location = item.querySelector(".listing-card").dataset.location.toLowerCase();
                item.style.display = (title.includes(term) || location.includes(term)) ? "block" : "none";
            });
        });
    </script>
</body>
